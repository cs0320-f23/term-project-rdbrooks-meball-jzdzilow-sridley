<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GetInfoHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">s0</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs32.livecode.dispatcher.handlers</a> &gt; <span class="el_source">GetInfoHandler.java</span></div><h1>GetInfoHandler.java</h1><pre class="source lang-java linenums">package edu.brown.cs32.livecode.dispatcher.handlers;

import com.squareup.moshi.Moshi;
import edu.brown.cs32.livecode.dispatcher.debuggingPartner.DebuggingPartner;
import edu.brown.cs32.livecode.dispatcher.debuggingPartner.DebuggingPartnerQueue;
import edu.brown.cs32.livecode.dispatcher.handlers.AddHelpRequesterHandler.FailureResponse;
import edu.brown.cs32.livecode.dispatcher.helpRequester.HelpRequester;
import edu.brown.cs32.livecode.dispatcher.helpRequester.HelpRequesterQueue;
import edu.brown.cs32.livecode.dispatcher.sessionState.SessionState;
import java.util.ArrayList;
import java.util.List;
import spark.Request;
import spark.Response;
import spark.Route;

/**
 * This class is the GetInfoHandler class, implements the Route interface such that it can be
 * attached to the endpoint /getInfo.
 *
 * &lt;p&gt;A call to the /getInfo endpoint allows the frontend to get information about the entire
 * session or about a specific DebuggingPartner or HelpRequester.
 *
 * @author sarahridley juliazdzilowska rachelbrooks meganball
 * @version 1.0
 */
public class GetInfoHandler implements Route {

  private HelpRequesterQueue helpRequesterQueue;
  private DebuggingPartnerQueue debuggingPartnerQueue;
  private SessionState sessionState;

  /**
   * Constructor for the GetInfoHandler class
   *
   * @param helpRequesterQueue HelpRequesterQueue containing all HelpRequester info
   * @param debuggingPartnerQueue DebuggingPartnerQueue containing all DebuggingPartner info
   * @param sessionState SessionState representing the current state of the session
   */
  public GetInfoHandler(
      HelpRequesterQueue helpRequesterQueue,
      DebuggingPartnerQueue debuggingPartnerQueue,
<span class="fc" id="L42">      SessionState sessionState) {</span>
<span class="fc" id="L43">    this.helpRequesterQueue = helpRequesterQueue;</span>
<span class="fc" id="L44">    this.debuggingPartnerQueue = debuggingPartnerQueue;</span>
<span class="fc" id="L45">    this.sessionState = sessionState;</span>
<span class="fc" id="L46">  }</span>

  /**
   * Helper function that accesses all information about the current Collab Hours Session
   *
   * @return Json Object containing result of this request
   */
  public Object getAllInfo() {
<span class="fc" id="L54">    List&lt;HelpRequester&gt; waitingHelpRequesters = helpRequesterQueue.getNeedHelpList();</span>
<span class="fc" id="L55">    List&lt;List&lt;String&gt;&gt; waitingHRQs = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">    for (HelpRequester helpRequester : waitingHelpRequesters) {</span>
<span class="nc" id="L57">      waitingHRQs.add(</span>
<span class="nc" id="L58">          List.of(</span>
<span class="nc" id="L59">              helpRequester.getName(), helpRequester.getEmail(), helpRequester.getJoinedTime()));</span>
<span class="nc" id="L60">    }</span>

<span class="fc" id="L62">    List&lt;HelpRequester&gt; pairedHelpRequesters = helpRequesterQueue.getGettingHelpList();</span>
<span class="fc" id="L63">    List&lt;List&lt;List&lt;String&gt;&gt;&gt; pairs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L64">    List&lt;List&lt;List&lt;String&gt;&gt;&gt; escalatedPairs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L65">    List&lt;List&lt;List&lt;String&gt;&gt;&gt; nonEscalatedPairs = new ArrayList&lt;&gt;();</span>

<span class="pc bpc" id="L67" title="1 of 2 branches missed.">    for (HelpRequester helpRequester : pairedHelpRequesters) {</span>
<span class="nc" id="L68">      DebuggingPartner helper = helpRequester.getDebuggingPartner();</span>
<span class="nc" id="L69">      pairs.add(</span>
<span class="nc" id="L70">          List.of(</span>
<span class="nc" id="L71">              List.of(helper.getName(), helper.getEmail()),</span>
<span class="nc" id="L72">              List.of(helpRequester.getName(), helpRequester.getEmail()),</span>
<span class="nc" id="L73">              List.of(helper.getPairedAtTime())));</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">      if (helpRequester.getEscalated()) {</span>
<span class="nc" id="L75">        escalatedPairs.add(</span>
<span class="nc" id="L76">            List.of(</span>
<span class="nc" id="L77">                List.of(helper.getName(), helper.getEmail()),</span>
<span class="nc" id="L78">                List.of(helpRequester.getName(), helpRequester.getEmail()),</span>
<span class="nc" id="L79">                List.of(helper.getPairedAtTime())));</span>
      } else {
<span class="nc" id="L81">        nonEscalatedPairs.add(</span>
<span class="nc" id="L82">            List.of(</span>
<span class="nc" id="L83">                List.of(helper.getName(), helper.getEmail()),</span>
<span class="nc" id="L84">                List.of(helpRequester.getName(), helpRequester.getEmail()),</span>
<span class="nc" id="L85">                List.of(helper.getPairedAtTime())));</span>
      }
<span class="nc" id="L87">    }</span>

<span class="fc" id="L89">    List&lt;DebuggingPartner&gt; debuggingPartners = debuggingPartnerQueue.getDebuggingPartnerList();</span>

<span class="fc" id="L91">    List&lt;List&lt;String&gt;&gt; openDBPs = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">    for (DebuggingPartner debuggingPartner : debuggingPartners) {</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">      if (debuggingPartner.isFree()) {</span>
<span class="nc" id="L94">        openDBPs.add(</span>
<span class="nc" id="L95">            List.of(</span>
<span class="nc" id="L96">                debuggingPartner.getName(),</span>
<span class="nc" id="L97">                debuggingPartner.getEmail(),</span>
<span class="nc" id="L98">                debuggingPartner.getJoinedTime()));</span>
      }
<span class="nc" id="L100">    }</span>

<span class="fc" id="L102">    List&lt;HelpRequester&gt; helped = helpRequesterQueue.getHelpedList();</span>
<span class="fc" id="L103">    List&lt;List&lt;String&gt;&gt; helpedNames = new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">    for (HelpRequester helpRequester : helped) {</span>
<span class="nc" id="L105">      helpedNames.add(</span>
<span class="nc" id="L106">          List.of(</span>
<span class="nc" id="L107">              helpRequester.getName(), helpRequester.getEmail(), helpRequester.getJoinedTime()));</span>
<span class="nc" id="L108">    }</span>

<span class="fc" id="L110">    return new AllInfoSuccessResponse(</span>
            &quot;Here is the waiting Help Requester queue, open Debugging Partner queue, current pairings, and past Help Requesters!&quot;,
            waitingHRQs,
            openDBPs,
            pairs,
            escalatedPairs,
            nonEscalatedPairs,
            helpedNames)
<span class="fc" id="L118">        .serialize();</span>
  }

  /**
   * Helper function that accesses all information about the current Collab Hours Session
   *
   * @param targetName String representing the name of the student to get info for
   * @param role String representing role of the student to get info for
   * @param targetEmail String representing the email of the student to get info for
   * @return Json Object containing result of this request
   */
  public Object getSpecificInfo(String targetName, String role, String targetEmail) {
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">    if (role.equals(&quot;debuggingPartner&quot;)) {</span>
<span class="fc" id="L131">      List&lt;DebuggingPartner&gt; debuggingPartners = debuggingPartnerQueue.getAllDebuggingPartnerList();</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">      for (DebuggingPartner debuggingPartner : debuggingPartners) {</span>
<span class="nc" id="L133">        String name = debuggingPartner.getName();</span>
<span class="nc" id="L134">        String email = debuggingPartner.getEmail();</span>
<span class="nc bnc" id="L135" title="All 4 branches missed.">        if (name.equals(targetName) &amp;&amp; email.equals(targetEmail)) {</span>
<span class="nc" id="L136">          HelpRequester currentlyHelping = debuggingPartner.getCurrentHelpRequester();</span>
<span class="nc" id="L137">          String helpingName = &quot;&quot;;</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">          if (currentlyHelping != null) {</span>
<span class="nc" id="L139">            helpingName = currentlyHelping.getName();</span>

<span class="nc" id="L141">            return new DebuggingPartnerInfoSuccessResponse(</span>
                    &quot;Debugging Partner &quot; + targetName + &quot; found!&quot;,
                    helpingName,
<span class="nc" id="L144">                    currentlyHelping.getEmail(),</span>
<span class="nc" id="L145">                    currentlyHelping.getBugType(),</span>
                    debuggingPartner)
<span class="nc" id="L147">                .serialize();</span>
          } else {
<span class="nc" id="L149">            return new DebuggingPartnerInfoSuccessResponse(</span>
                    &quot;Debugging Partner &quot; + targetName + &quot; found!&quot;,
                    helpingName,
                    &quot;&quot;,
                    &quot;&quot;,
                    debuggingPartner)
<span class="nc" id="L155">                .serialize();</span>
          }
        }
<span class="nc" id="L158">      }</span>
<span class="pc bnc" id="L159" title="All 2 branches missed.">    } else if (role.equals(&quot;helpRequester&quot;)) {</span>
<span class="nc" id="L160">      List&lt;HelpRequester&gt; helpRequesters = helpRequesterQueue.getAllHelpRequesters();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">      for (HelpRequester helpRequester : helpRequesters) {</span>
<span class="nc" id="L162">        String name = helpRequester.getName();</span>
<span class="nc" id="L163">        String email = helpRequester.getEmail();</span>
<span class="nc bnc" id="L164" title="All 4 branches missed.">        if (name.equals(targetName) &amp;&amp; email.equals(targetEmail)) {</span>
<span class="nc" id="L165">          DebuggingPartner gettingHelpFrom = helpRequester.getDebuggingPartner();</span>
<span class="nc" id="L166">          String helpFromName = &quot;&quot;;</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">          if (gettingHelpFrom != null) {</span>
<span class="nc" id="L168">            helpFromName = gettingHelpFrom.getName();</span>
          }
<span class="nc" id="L170">          return new HelpRequesterInfoSuccessResponse(</span>
                  &quot;Help Requester &quot; + targetName + &quot; found!&quot;, helpFromName, helpRequester)
<span class="nc" id="L172">              .serialize();</span>
        }
<span class="nc" id="L174">      }</span>
    }
<span class="fc" id="L176">    return new FailureResponse(</span>
            &quot;error_bad_request&quot;,
            &quot;No &quot; + role + &quot; found named &quot; + targetName + &quot; with email &quot; + targetEmail)
<span class="fc" id="L179">        .serialize();</span>
  }

  /**
   * Handler for a call to the /flagAndRematch endpoint
   *
   * @param request Request object containing parameters
   * @param response Response object that is unused
   * @return Json Object containing result of this request
   */
  @Override
  public Object handle(Request request, Response response) throws Exception {
<span class="fc bfc" id="L191" title="All 2 branches covered.">    if (!sessionState.getRunning()) {</span>
<span class="fc" id="L192">      return new FailureResponse(&quot;error_bad_request&quot;, &quot;No session is running.&quot;).serialize();</span>
    }
<span class="fc" id="L194">    String name = request.queryParams(&quot;name&quot;);</span>
<span class="fc" id="L195">    String role = request.queryParams(&quot;role&quot;);</span>
<span class="fc" id="L196">    String email = request.queryParams(&quot;email&quot;);</span>
<span class="pc bpc" id="L197" title="2 of 6 branches missed.">    if (name == null || role == null || email == null) {</span>
<span class="fc" id="L198">      return getAllInfo();</span>
    } else {
<span class="fc" id="L200">      return getSpecificInfo(name, role, email);</span>
    }
  }

  /**
   * Record representing a success response to request for all info
   *
   * @param result String brief success response
   * @param message String verbose success response
   * @param waitingHRQs list of String of names of waiting HelpRequesters
   * @param openDBPs list of String of free DebuggingPartners
   * @param pairs nested list of String of pairs (DP first, then HR)
   * @param escalatedPairs nested list of String of escalated pairs (DP first, then HR)
   * @param escalatedPairs nested list of String of non-escalated pairs (DP first, then HR)
   * @param helpedNames list of String of helped HelpRequesters
   */
<span class="fc" id="L216">  public record AllInfoSuccessResponse(</span>
      String result,
      String message,
      List&lt;List&lt;String&gt;&gt; waitingHRQs,
      List&lt;List&lt;String&gt;&gt; openDBPs,
      List&lt;List&lt;List&lt;String&gt;&gt;&gt; pairs,
      List&lt;List&lt;List&lt;String&gt;&gt;&gt; escalatedPairs,
      List&lt;List&lt;List&lt;String&gt;&gt;&gt; nonEscalatedPairs,
      List&lt;List&lt;String&gt;&gt; helpedNames) {
    public AllInfoSuccessResponse(
        String message,
        List&lt;List&lt;String&gt;&gt; waitingHRQs,
        List&lt;List&lt;String&gt;&gt; openDBPs,
        List&lt;List&lt;List&lt;String&gt;&gt;&gt; pairs,
        List&lt;List&lt;List&lt;String&gt;&gt;&gt; escalatedPairs,
        List&lt;List&lt;List&lt;String&gt;&gt;&gt; nonEscalatedPairs,
        List&lt;List&lt;String&gt;&gt; helpedNames) {
<span class="fc" id="L233">      this(</span>
          &quot;success&quot;,
          message,
          waitingHRQs,
          openDBPs,
          pairs,
          escalatedPairs,
          nonEscalatedPairs,
          helpedNames);
<span class="fc" id="L242">    }</span>

    String serialize() {
<span class="fc" id="L245">      Moshi moshi = new Moshi.Builder().build();</span>
<span class="fc" id="L246">      return moshi.adapter(AllInfoSuccessResponse.class).toJson(this);</span>
    }
  }

  /**
   * Record representing a success request for accessing info of a DebuggingPartner
   *
   * @param result String brief success message
   * @param message String verbose success message
   * @param name String representing DebuggingPartner's name
   * @param helpRequesterName String representing current HelpRequester's name
   * @param flagged boolean representing whether DebuggingPartner was flagged
   * @param studentsHelped int representing how many students the DebuggingPartner has helped
   */
<span class="fc" id="L260">  public record DebuggingPartnerInfoSuccessResponse(</span>
      String result,
      String message,
      String name,
      String email,
      String joinedTime,
      String pairedAtTime,
      String helpRequesterName,
      String helpRequesterEmail,
      String helpRequesterBug,
      boolean flagged,
      int studentsHelped) {
    public DebuggingPartnerInfoSuccessResponse(
        String message,
        String currentlyHelping,
        String helpRequesterEmail,
        String helpRequesterBug,
        DebuggingPartner debuggingPartner) {
<span class="fc" id="L278">      this(</span>
          &quot;success&quot;,
          message,
<span class="fc" id="L281">          debuggingPartner.getName(),</span>
<span class="fc" id="L282">          debuggingPartner.getEmail(),</span>
<span class="fc" id="L283">          debuggingPartner.getJoinedTime(),</span>
<span class="fc" id="L284">          debuggingPartner.getPairedAtTime(),</span>
          currentlyHelping,
          helpRequesterEmail,
          helpRequesterBug,
<span class="fc" id="L288">          debuggingPartner.getFlagged(),</span>
<span class="fc" id="L289">          debuggingPartner.getStudentsHelped());</span>
<span class="fc" id="L290">    }</span>

    String serialize() {
<span class="nc" id="L293">      Moshi moshi = new Moshi.Builder().build();</span>
<span class="nc" id="L294">      return moshi.adapter(DebuggingPartnerInfoSuccessResponse.class).toJson(this);</span>
    }
  }

  /**
   * Record representing a successful request for accessing info of a HelpRequester
   *
   * @param result String brief success message
   * @param message String verbose success message
   * @param name String representing the HelpRequester's name
   * @param debuggingPartnerName String representing the DebuggingPartner helping this student
   */
<span class="fc" id="L306">  public record HelpRequesterInfoSuccessResponse(</span>
      String result,
      String message,
      String name,
      String email,
      String joinedTime,
      String pairedAtTime,
      String debuggingPartnerName,
      String bugType,
      boolean escalated,
      boolean debugged) {
    public HelpRequesterInfoSuccessResponse(
        String message, String debuggingPartnerName, HelpRequester helpRequester) {
<span class="fc" id="L319">      this(</span>
          &quot;success&quot;,
          message,
<span class="fc" id="L322">          helpRequester.getName(),</span>
<span class="fc" id="L323">          helpRequester.getEmail(),</span>
<span class="fc" id="L324">          helpRequester.getJoinedTime(),</span>
<span class="fc" id="L325">          helpRequester.getPairedAtTime(),</span>
          debuggingPartnerName,
<span class="fc" id="L327">          helpRequester.getBugType(),</span>
<span class="fc" id="L328">          helpRequester.getEscalated(),</span>
<span class="fc" id="L329">          helpRequester.getDebugged());</span>
<span class="fc" id="L330">    }</span>

    String serialize() {
<span class="nc" id="L333">      Moshi moshi = new Moshi.Builder().build();</span>
<span class="nc" id="L334">      return moshi.adapter(HelpRequesterInfoSuccessResponse.class).toJson(this);</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>