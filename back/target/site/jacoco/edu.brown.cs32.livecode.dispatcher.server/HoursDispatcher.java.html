<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HoursDispatcher.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">s0</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs32.livecode.dispatcher.server</a> &gt; <span class="el_source">HoursDispatcher.java</span></div><h1>HoursDispatcher.java</h1><pre class="source lang-java linenums">package edu.brown.cs32.livecode.dispatcher.server;

import edu.brown.cs32.livecode.dispatcher.debuggingPartner.DebuggingPartner;
import edu.brown.cs32.livecode.dispatcher.debuggingPartner.DebuggingPartnerQueue;
import edu.brown.cs32.livecode.dispatcher.helpRequester.HelpRequester;
import edu.brown.cs32.livecode.dispatcher.helpRequester.HelpRequesterQueue;
import edu.brown.cs32.livecode.dispatcher.sessionState.SessionState;
import edu.brown.cs32.livecode.dispatcher.utils.Utils;

/**
 * Revised version of the prior dispatcher example from Tim's lecture. This dispatcher handles
 * matching DebuggingPartners with HelpRequesters.
 *
 * @author timnelson sarahridley juliazdzilowska rachelbrooks meganball
 * @version 1.1
 */
public class HoursDispatcher {
  private final HelpRequesterQueue helpRequesterQueue;
  private final DebuggingPartnerQueue debuggingPartnerQueue;
  private final String statusMessage;

  /**
   * Constructor for the HoursDispatcher class
   *
   * @param helpRequesterQueue HelpRequesterQueue containing all HelpRequester info
   * @param debuggingPartnerQueue DebuggingPartnerQueue containing all DebuggingPartner info
   * @param statusMessage String representing current status
   */
  public HoursDispatcher(
      HelpRequesterQueue helpRequesterQueue,
      DebuggingPartnerQueue debuggingPartnerQueue,
<span class="fc" id="L32">      String statusMessage) {</span>
<span class="fc" id="L33">    this.helpRequesterQueue = helpRequesterQueue;</span>
<span class="fc" id="L34">    this.debuggingPartnerQueue = debuggingPartnerQueue;</span>
<span class="fc" id="L35">    this.statusMessage = statusMessage;</span>
<span class="fc" id="L36">  }</span>

  /**
   * Getter for the statusMessage field
   *
   * @return String representing the statusMessage field
   */
  public String getStatusMessage() {
<span class="fc" id="L44">    return statusMessage;</span>
  }

  /**
   * Dispatches free DebuggingPartners to waiting HelpRequesters
   *
   * @param sessionState SessionState representing the current state of the session
   */
  public void dispatch(SessionState sessionState, boolean test) {
<span class="fc" id="L53">    System.out.println(</span>
<span class="fc" id="L54">        Utils.timestamp()</span>
            + &quot; Dispatcher: Welcome to edu.brown.cs32.livecode.threads.TA hours! Today we're discussing &quot;
<span class="fc" id="L56">            + this.getStatusMessage());</span>
    // Only loop while the session is still running
<span class="fc" id="L58">    int iterations = 0;</span>
    // If we're in testing mode, we do max 5 iterations
<span class="pc bpc" id="L60" title="1 of 6 branches missed.">    while (sessionState.getRunning() &amp;&amp; (!test || iterations &lt; 2)) {</span>
<span class="fc" id="L61">      iterations++;</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">      if (helpRequesterQueue.getNeedHelp().hasNext()) {</span>
        // Who will help this student?
<span class="fc" id="L64">        DebuggingPartner helper = null;</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">        while (sessionState.getRunning()) {</span>
<span class="fc" id="L66">          synchronized (debuggingPartnerQueue) {</span>
<span class="fc" id="L67">            DebuggingPartner debuggingPartner = this.debuggingPartnerQueue.nextDebuggingPartner();</span>
<span class="pc bpc" id="L68" title="2 of 4 branches missed.">            if (debuggingPartner != null &amp;&amp; debuggingPartner.isFree()) {</span>
<span class="fc" id="L69">              helper = debuggingPartner;</span>
<span class="fc" id="L70">              debuggingPartner.incrementStudentsHelper();</span>
<span class="fc" id="L71">              break;</span>
            }
<span class="nc" id="L73">          }</span>
        }
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">        if (helper == null) continue; // no available TA</span>

<span class="fc" id="L77">        HelpRequester nextHelpRequester = helpRequesterQueue.getNeedHelp().next();</span>
<span class="fc" id="L78">        nextHelpRequester.setDebuggingPartner(helper);</span>
<span class="fc" id="L79">        helpRequesterQueue.claimHelpRequester(nextHelpRequester);</span>

        // Help the student
<span class="fc" id="L82">        System.out.println(</span>
<span class="fc" id="L83">            Utils.timestamp()</span>
                + &quot; Dispatcher: Hi &quot;
                + nextHelpRequester
                + &quot;; you'll be seen by &quot;
                + helper);
        try {
<span class="fc" id="L89">          helper.seeStudent(nextHelpRequester);</span>
<span class="nc" id="L90">        } catch (Exception e) {</span>
<span class="nc" id="L91">          System.out.println(</span>
              &quot;Unexpected behavior: edu.brown.cs32.livecode.threads.TA timed out while assigning student!&quot;);
<span class="fc" id="L93">        }</span>
<span class="fc" id="L94">      } else {</span>
        try {
          // nobody is waiting; go to sleep for a bit
<span class="fc" id="L97">          System.out.println(</span>
<span class="fc" id="L98">              Utils.timestamp()</span>
                  + &quot; Dispatcher: Nobody waiting in queue, will check again in three seconds.&quot;);
<span class="fc" id="L100">          Thread.sleep(3000);</span>
<span class="nc" id="L101">        } catch (InterruptedException e) {</span>
<span class="nc" id="L102">          System.out.println(&quot;Dispatcher terminated.&quot;);</span>
<span class="pc" id="L103">        }</span>
      }
    }
<span class="fc" id="L106">    System.out.println(Utils.timestamp() + &quot; Dispatcher: The current session has ended.&quot;);</span>
<span class="fc" id="L107">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>